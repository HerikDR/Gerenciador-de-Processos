<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" th:classappend="${tema == 'dark' ? 'dark-theme' : ''}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Processos</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- CSS Customizado com Dark Mode -->
    <style>
        /* VARIAVEIS CSS */
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #0dcaf0;
            /* Cores Modo Claro */
            --bg-color: #f8f9fa;
            --bg-card: #ffffff;
            --text-color: #212529;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --navbar-bg: #0d6efd;
            --footer-bg: #ffffff;
        }

        /* DARK MODE VARIABLES */
        .dark-theme {
            --bg-color: #1a1a1a;
            --bg-card: #2d2d2d;
            --text-color: #e9ecef;
            --text-muted: #adb5bd;
            --border-color: #495057;
            --navbar-bg: #0a0a0a;
            --footer-bg: #2d2d2d;
            /* Ajustar Bootstrap para dark mode */
            --bs-body-bg: #1a1a1a;
            --bs-body-color: #e9ecef;
        }

        /* ESTILOS GERAIS */
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            transition: all 0.3s ease;
        }

        .navbar {
            background-color: var(--navbar-bg) !important;
            border-bottom: 1px solid var(--border-color);
        }

        .navbar-brand {
            font-weight: 600;
            font-size: 1.25rem;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .processo-card {
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .processo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-left-color: var(--primary-color);
        }

        .dark-theme .processo-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }

        /* BADGES */
        .badge-ocioso { background-color: #6c757d !important; color: white !important; }
        .badge-baixa { background-color: #198754 !important; color: white !important; }
        .badge-media { background-color: #ffc107 !important; color: #000 !important; }
        .badge-alta { background-color: #fd7e14 !important; color: white !important; }
        .badge-urgente { background-color: #dc3545 !important; color: white !important; }

        /* STATS CARDS */
        .stats-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .dark-theme .stats-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* FORMULARIOS E INPUTS */
        .form-control, .form-select {
            background-color: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-color);
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--bg-card);
            border-color: var(--primary-color);
            color: var(--text-color);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        .input-group-text {
            background-color: var(--bg-card);
            border-color: var(--border-color);
            color: var(--text-muted);
        }

        /* FOOTER */
        footer {
            background-color: var(--footer-bg);
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
        }

        /* BOTAO MODO ESCURO */
        .theme-toggle {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            border: none;
            border-radius: 50px;
            padding: 0.5rem 1rem;
            color: #000;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-theme .theme-toggle {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: #e2e8f0;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            color: inherit;
        }

        .theme-toggle i {
            font-size: 1rem;
        }

        /* TEXTO MUTED */
        .text-muted {
            color: var(--text-muted) !important;
        }

        /* ALERTAS DARK MODE */
        .dark-theme .alert-success {
            background-color: rgba(25, 135, 84, 0.2);
            border-color: rgba(25, 135, 84, 0.3);
            color: #75b798;
        }

        .dark-theme .alert-danger {
            background-color: rgba(220, 53, 69, 0.2);
            border-color: rgba(220, 53, 69, 0.3);
            color: #f1919a;
        }
    </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
    <div class="container">
        <a class="navbar-brand" th:href="@{/processos(tema=${tema})}">
            <i class="bi bi-list-task"></i> Gerenciador de Processos
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                </li>
            </ul>
            <!-- Botao Toggle Tema -->
            <div class="d-flex">
                <a th:href="@{/processos(tema=${tema == 'dark' ? null : 'dark'}, busca=${busca})}" class="theme-toggle">
                    <i th:class="${tema == 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill'}"></i>
                    <span th:text="${tema == 'dark' ? 'Modo Claro' : 'Modo Escuro'}">Modo Escuro</span>
                </a>
            </div>
        </div>
    </div>
</nav>

<!-- Container Principal -->
<div class="container mt-4">
    <!-- Cabecalho da Pagina -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <div>
            <h1 class="h3 mb-2">
                <i class="bi bi-list-task text-primary me-2"></i> Lista de Processos
            </h1>
            <p class="text-muted mb-0">Gerencie todos os seus processos organizacionais</p>
        </div>
        <div class="mt-3 mt-md-0">
            <a th:href="@{/processos/novo(tema=${tema})}" class="btn btn-primary">
                <i class="bi bi-plus-circle me-1"></i> Novo Processo
            </a>
        </div>
    </div>

    <!-- Alertas -->
    <div th:if="${sucesso}" class="alert alert-success alert-dismissible fade show">
        <i class="bi bi-check-circle me-2"></i>
        <span th:text="${sucesso}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${erro}" class="alert alert-danger alert-dismissible fade show">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <span th:text="${erro}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Barra de Pesquisa -->
    <div class="row mb-4">
        <div class="col-md-8">
            <form th:action="@{/processos}" method="get" class="d-flex">
                <input type="hidden" th:name="tema" th:value="${tema}">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" name="busca" th:value="${busca}" placeholder="Pesquisar por tÃ­tulo do processo...">
                    <button class="btn btn-outline-primary" type="submit">Buscar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Estatisticas -->
    <div class="row mb-4">
        <div class="col-6 col-lg-3 mb-3 mb-lg-0">
            <div class="card stats-card text-center h-100">
                <div class="card-body py-3">
                    <div class="d-flex align-items-center justify-content-center mb-2">
                        <i class="bi bi-list-task h4 text-primary mb-0 me-2"></i>
                        <h4 class="card-title text-primary mb-0" th:text="${#lists.size(processos)}">0</h4>
                    </div>
                    <p class="card-text text-muted small mb-0">Total</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3 mb-3 mb-lg-0">
            <div class="card stats-card text-center h-100">
                <div class="card-body py-3">
                    <div class="d-flex align-items-center justify-content-center mb-2">
                        <i class="bi bi-check-circle h4 text-success mb-0 me-2"></i>
                        <h4 class="card-title text-success mb-0" th:text="${#lists.size(processos.?[concluido == true])}">0</h4>
                    </div>
                    <p class="card-text text-muted small mb-0">ConcluÃ­dos</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3 mb-3 mb-lg-0">
            <div class="card stats-card text-center h-100">
                <div class="card-body py-3">
                    <div class="d-flex align-items-center justify-content-center mb-2">
                        <i class="bi bi-clock h4 text-warning mb-0 me-2"></i>
                        <h4 class="card-title text-warning mb-0" th:text="${#lists.size(processos.?[concluido == false])}">0</h4>
                    </div>
                    <p class="card-text text-muted small mb-0">Em Andamento</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-lg-3">
            <div class="card stats-card text-center h-100">
                <div class="card-body py-3">
                    <div class="d-flex align-items-center justify-content-center mb-2">
                        <i class="bi bi-exclamation-triangle h4 text-danger mb-0 me-2"></i>
                        <h4 class="card-title text-danger mb-0" th:text="${#lists.size(processos.?[!concluido && #temporals.createToday().isAfter(dataTermino)])}">0</h4>
                    </div>
                    <p class="card-text text-muted small mb-0">Atrasados</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Estado Vazio -->
    <div th:if="${#lists.isEmpty(processos)}" class="text-center py-5">
        <div class="mb-4">
            <i class="bi bi-inbox display-1 text-muted"></i>
        </div>
        <h4 class="text-muted">Nenhum processo cadastrado</h4>
        <p class="text-muted mb-4">Comece criando seu primeiro processo organizacional</p>
        <a th:href="@{/processos/novo(tema=${tema})}" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle me-2"></i> Criar Primeiro Processo
        </a>
    </div>

    <!-- Lista de Processos -->
    <div th:unless="${#lists.isEmpty(processos)}" class="row">
        <div th:each="processo : ${processos}" class="col-12 mb-3">
            <div class="card processo-card shadow-sm h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-start justify-content-between">
                                <div class="flex-grow-1">
                                    <h5 class="card-title mb-2" th:text="${processo.titulo}">TÃ­tulo do Processo</h5>
                                    <p class="card-text text-muted mb-3" th:if="${processo.descricao}" th:text="${#strings.abbreviate(processo.descricao, 100)}">DescriÃ§Ã£o do processo</p>
                                </div>
                            </div>
                            <div class="d-flex flex-wrap gap-2 mb-2">
                                <span class="badge" th:classappend="'badge-' + ${#strings.toLowerCase(processo.prioridade)}" th:text="${processo.prioridade}">
                                    <i class="bi bi-flag me-1"></i> Prioridade
                                </span>
                                <span class="badge" th:classappend="${processo.concluido ? 'bg-success' : 'bg-warning'}">
                                    <i class="bi" th:classappend="${processo.concluido ? 'bi-check-circle' : 'bi-clock'}"></i>
                                    <span th:text="${processo.concluido ? 'ConcluÃ­do' : 'Em Andamento'}"></span>
                                </span>
                                <span class="badge bg-secondary">
                                    <i class="bi bi-person me-1"></i> <span th:text="${processo.feitoPor}">ResponsÃ¡vel</span>
                                </span>
                                <span class="badge bg-info">
                                    <i class="bi bi-arrow-right me-1"></i> <span th:text="${processo.paraQuem}">DestinatÃ¡rio</span>
                                </span>
                            </div>
                            <!-- Gaveta de Subpassos (sem JS) -->
                            <details>
                                <summary>Subpassos</summary>
                                <ul>
                                    <li th:each="subpasso : ${processo.subPassos}">
                                        <span th:text="${subpasso.descricao}"></span> (ConcluÃ­do: <span th:text="${subpasso.concluido ? 'Sim' : 'NÃ£o'}"></span>)
                                    </li>
                                </ul>
                            </details>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="mb-3">
                                <small class="text-muted d-block">
                                    <i class="bi bi-calendar-event me-1"></i>
                                    <span th:text="${#temporals.format(processo.dataInicio, 'dd/MM/yyyy')}">01/01/2025</span>
                                    <i class="bi bi-arrow-right mx-2"></i>
                                    <span th:text="${#temporals.format(processo.dataTermino, 'dd/MM/yyyy')}">31/01/2025</span>
                                </small>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <a th:href="@{/processos/editar/{id}(id=${processo.id}, tema=${tema})}" class="btn btn-outline-primary" title="Editar Processo">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form th:action="@{/processos/deletar/{id}(id=${processo.id})}" method="post" style="display: inline;">
                                    <input type="hidden" th:name="tema" th:value="${tema}">
                                    <button type="submit" class="btn btn-outline-danger" title="Excluir Processo" onclick="return confirm('ATENÃÃO! VocÃª realmente deseja excluir o processo? Essa aÃ§Ã£o nÃ£o pode ser desfeita.')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


